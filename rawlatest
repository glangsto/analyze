#!/bin/bash
# plot the latest observation compared to latest hot
# HISTORY
# 20Dec24 GIL check for no hot and create latest file in html directory
# 20Nov12 GIL create latest file in html directory
# 20Jun16 GIL initial version that finds the latest observation
# find the most recent note file 

export datadir=/home/pi/Research/gr-radio_astro/data
export grhome=/home/pi/Research/gr-radio_astro

export binhome=/home/pi/Research/analyze
export latesthot=`$binhome/getlatesthot`
export latestobs=`$binhome/getlatestobs`
export latestdir="/var/www/html/latest"
# go to one directory above the data dir
cd $grhome
if [ "$latesthot" != "" ] ; then
    export latesthot=data/$latesthot
fi
if [ "$latestobs" != "" ] ; then
    export latestobs=data/$latestobs
fi

if [ "$latestobs" == "" ] && [ "$latesthot" == "" ] ; then
    exit
fi


echo $latesthot $latestobs
$binhome/R -P $latestdir/ $latestobs $latesthot

# link the latest png for easy access to web page
export latestpng=$latestdir/R-latest.png
# now relink to the last latest plot
if [ -f  $latestpng ] ; then
    sudo rm $latestpng
fi

export newestpng=`ls -t $latestdir/R*.png | head -1`
#echo "Newest: " $newestpng
if [ "$newestpng" != "$latestpng" ] ; then 
    sudo ln -s $newestpng $latestpng
fi

# link the latest png for easy access to web page
export latestpdf=$latestdir/R-latest.pdf
if [ -f  $latestpdf ] ; then
    sudo rm $latestpdf
fi    

export newestpdf=`ls -t $latestdir/R*.pdf | head -1`
#echo "Newest: " $newestpdf
if [ "$newestpdf" != "$latestpdf" ] ; then 
    sudo ln -s $newestpdf $latestpdf
fi

#must touch the files to get them to refresh
sudo touch $latestpdf
sudo touch $latestpng
